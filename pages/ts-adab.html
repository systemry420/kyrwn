<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../style2.css">
    <title>Kayrawan Quiz</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
     
        <!-- Initialize Firebase -->
        <script>
            
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyAiEA_TpvnjNib-EWCxn2awsT4x5L4kRwA",
            authDomain: "kayrawan-quiz.firebaseapp.com",
            databaseURL: "https://kayrawan-quiz.firebaseio.com",
            projectId: "kayrawan-quiz",
            storageBucket: "kayrawan-quiz.appspot.com",
            messagingSenderId: "468059140378",
            appId: "1:468059140378:web:7cc6d6f2cbb97962fafca3",
            measurementId: "G-FL849SJ7KJ"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        // make firestore ref
        const db = firebase.firestore()
        
        // make auth ref
        const auth = firebase.auth()

        db.settings({ timestampsInSnapshots: true})
        </script>
    
</head>
<body>
    <nav>
        <ul>
            <li>
                <a href="../index.html">
                    <i class="fa fa-home fa-3x"></i>
                </a>
            </li>
            <li>
                <a href="../about.html">
                    <i class="fa fa-university fa-2x"></i>
                    <span>
                        عن المعهد
                    </span>
                </a>
            </li>
            <li>
                <a href="../contact.html">
                <i class="fa fa-mobile fa-3x"></i>
                    <span>
                        اتصل بنا
                    </span>
                </a>
            </li>
            <li>
                <a href="../staff.html">
                    <i class="fa fa-address-card fa-2x"></i>
                    <span>
                        من نحن
                    </span>
                </a>
            </li>
        </ul>
    </nav>

    <main>
        <div id="image">
            <img src="../logo.jpg"  height="120" />
            <h1> أدب أطفال</h1>
        </div>
        <button id="start">بدء الاختبار</button>
        <div class="container" id="quiz">
            <div class="container-header">
                <h1 id="question"></h1>
                <ul id="list">
                    <li>
                        <input type="radio" name="answer" id="0" class="answer">
                        <label for="1" id="a_text"></label>
                    </li>
                    <li>
                        <input type="radio" name="answer" id="1" class="answer">
                        <label for="2" id="b_text"></label>
                    </li>
                    <li>
                        <input type="radio" name="answer" id="2" class="answer">
                        <label for="3" id="c_text"></label>
                    </li>
                </ul>
            </div>
        <button id="submit">متابعة</button>
        </div>
    </main>

    <script>
        const main = document.querySelector('main')
        const start = document.querySelector('#start')
        let currentQuiz = 0;
        let score = 0;
        let answer = undefined;
        const questionEl = document.getElementById('question');
        const quiz = document.getElementById('quiz');
        const aEl = document.getElementById('a_text');
        const bEl = document.getElementById('b_text');
        const cEl = document.getElementById('c_text');
        const submitBtn = document.getElementById('submit');
        let answerEls = document.querySelectorAll('.answer');
        let question = null

        start.addEventListener('click', ()=>{
            showQuiz()
        })

        let quizData = null,
            arr = null;
        // window.addEventListener('load', showQuiz)
        function showQuiz() {
            start.style.display = 'none'
            const ref = db.collection('quiz6')
            
            ref.get().then(snap=>{
                snap.docs.forEach(doc=>{
                    quizData=Object.entries(doc.data())
                    loadQuiz(quizData)
                    // console.log(quizData);
                })
            })
        }
        
        
        function loadQuiz(quizData) {
            arr = quizData
            loadQuestion()
            quiz.style.display = 'block'
        }
        
        function loadQuestion(){
            question = arr[currentQuiz]
            // check(question)
            questionEl.innerText = question[0];
            const options = question[1].slice(0,3);
            aEl.innerText = options[0]
            bEl.innerText = options[1]
            cEl.innerText = options[2]
        }
        
        function check(ans) {
            // console.log(question[1][3], ans);
            if(ans ==  question[1][3])
                return true;
            return false
        }

        function getSelected (){
            answerEls.forEach((answerEl)=>{
                if(answerEl.checked){
                    answer = answerEl.id;
                }
            });
            return answer;
        }

        function deselect(){
            answerEls.forEach((answerEl)=>{
                answerEl.checked = false;
            })
        }

        submitBtn.addEventListener("click", ()=>{
            let yourAnswer = getSelected();
            // console.log(yourAnswer);
            if(yourAnswer){
                if(check(yourAnswer)){
                    // console.log(check(yourAnswer));
                    score++;
                }
                deselect();
                currentQuiz++;
                if(currentQuiz < arr.length){
                    loadQuestion();
                }
                else {
                    quiz.innerHTML = `<h2 style='padding: 1em'> لقد قمت بالإجابة عن ${score} من أصل ${quizData.length}</h2>
                    <button onclick='location.reload()'>إعادة الاختبار</button>
                    `;
                }
            }
            yourAnswer = false

        })
    </script>
</body>
</html>
